//tealium universal tag - utag.21 ut4.0.202508160016, Copyright 2025 Tealium.com Inc. All Rights Reserved.
try{(function(id,loader){var u={};utag.o[loader].sender[id]=u;if(utag===undefined){utag={};}if(utag.ut===undefined){utag.ut={};}if(utag.ut.loader===undefined){u.loader=function(o){var a,b,c,l;a=document;if(o.type==="iframe"){b=a.createElement("iframe");b.setAttribute("height","1");b.setAttribute("width","1");b.setAttribute("style","display:none");b.setAttribute("src",o.src);}else if(o.type==="img"){utag.DB("Attach img: "+o.src);b=new Image();b.src=o.src;return;}else{b=a.createElement("script");b.language="javascript";b.type="text/javascript";b.async=1;b.charset="utf-8";b.src=o.src;}if(o.id){b.id=o.id;}if(typeof o.cb==="function"){if(b.addEventListener){b.addEventListener("load",function(){o.cb();},false);}else{b.onreadystatechange=function(){if(this.readyState==="complete"||this.readyState==="loaded"){this.onreadystatechange=null;o.cb();}};}}l=o.loc||"head";c=a.getElementsByTagName(l)[0];if(c){utag.DB("Attach to "+l+": "+o.src);if(l==="script"){c.parentNode.insertBefore(b,c);}else{c.appendChild(b);}}};}else{u.loader=utag.ut.loader;}
u.ev={'view':1};u.initialized=false;u.map={};u.extend=[function(a,b){try{if(1){const fireDartTag=()=>{(function(parent,name,context,definition){if(!context||!context[parent]||!Array.prototype.filter){return;}
context[parent]['plugins'][name]=definition();})('bactm','googleDartTag',typeof window!=='undefined'?window:null,function(){const bactm=window.bactm;const version='1.0.0';const LOG_LEVEL={OFF:10,FATAL:5,ERROR:4,WARN:3,INFO:2,DEBUG:1};bactm._log('bactm.plugins.googleDartTag v'+version+' initializing.',LOG_LEVEL.INFO);const DART_LOG={PAGEVIEW:{SUCCESS:'Firing pageview DART tag',ERROR:'There was an error when trying to fire the DART pageview'},CUSTOM_EVENT:{SUCCESS:'Firing custom event DART tag',ERROR:'There was an error when trying to fire the custom event DART'},CLICK_EVENT:{SUCCESS:'Firing click event DART tag',ERROR:'There was an error when trying to fire DART click event'},DEFAULT:{SUCCESS:'Firing DART tag',ERROR:'There was an error when trying to fire the DART tag'}};if(!digitalData)return;window.gDataLayer=window.gDataLayer||[];window.gtag=function(){window.gDataLayer.push(arguments);}
window.gtag('js',new Date());function Adapter(){}
Adapter.prototype.process={findStandardDartURL:function(details){const pageInfo=(details&&details.pageInfo&&details.pageInfo.standardDART)?details.pageInfo:digitalData.page.pageInfo[details.pageInfoArrayIndex];const pageAttributes=digitalData.page.attributes;const dartFromPageInfo=this.checkForVariable(pageInfo.standardDART);const dartFromAttributesEn=this.checkForVariable(pageAttributes.standardDART);const dartFromAttributesEs=this.checkForVariable(pageAttributes.standardDARTes);if(pageInfo.language=='es'&&dartFromAttributesEs){return pageAttributes.standardDARTes;}else if(dartFromPageInfo){return pageInfo.standardDART;}else if(dartFromAttributesEn){return pageAttributes.standardDART;}else{return null;}},extractParamsFromDartURL:function(dartUrl){if(typeof dartUrl!=='undefined'){if(typeof dartUrl==='string')dartUrl=bactm._asArray(dartUrl);try{let dartUrlParams=[];dartUrl.forEach((url,index)=>{if(!this.isAcceptableUrl(url)){bactm._log('The DART URL provided is not a valid URL. No action was taken.',url,LOG_LEVEL.ERROR);return;}
let paramObj={url:url};params=url.split(';').slice(1).filter(Boolean);params.forEach(param=>{const[key,value]=param.split('=');paramObj[key]=value;});const cart=digitalData.cart;if(cart){const cartAttributes=digitalData.cart.attributes;const applicationID=cart.applicationID||cartAttributes.applicationId;if(applicationID){paramObj.u3=applicationID;paramObj.match_id=applicationID;}
if(cartAttributes.sourceCode)paramObj.u18=cartAttributes.sourceCode;if(cart.item&&cart.item.length>0){const productItem=digitalData.cart.item[index];const productInfo=productItem.productInfo;if(productItem?.category?.primaryCategory)paramObj.u24=productItem.category.primaryCategory;if(productInfo?.productName)paramObj.u25=productInfo.productName;if(productInfo?.productID)paramObj.u26=productInfo.productID;}
if(cartAttributes.status)paramObj.u27=cartAttributes.status;}
if(!paramObj.num){const ranNum=Math.random()*10000000000000;paramObj.num=ranNum;}
dartUrlParams.push(paramObj);});return dartUrlParams;}catch(e){bactm._log('There was an error when trying to fire the DART tag.',e,LOG_LEVEL.ERROR);}}},extractParamsFromCustomEvent:function(dartTags){let dartUrlParams=[];dartTags.forEach(dartObj=>{let paramObj={};const regex=/(\w+)=([^;|]+)/g;const matches=dartString.match(regex);if(matches){matches.forEach(match=>{const[key,value]=match.split("=");paramObj[key]=value;})}
dartUrlParams.push(paramObj);});return dartUrlParams;},setupClickDart:function(){const clickDartParameters=adapter.process.clickDartLookupTable()||adapter.process.findClickDartDDO();if(clickDartParameters.length)adapter.process.setupClickEvenListeners(clickDartParameters);},clickDartLookupTable:function(){try{let dartUrlsForElements=[];let lookupTable=utag_data['dart_lookup_click_element'];if(typeof lookupTable==='undefined')return;if(lookupTable!="undefined"){lookupTable=utag_data['dart_lookup_click_element'];}
dartUrlsForElements=this.findClickDartDDO();lookupTable.split('|').forEach(function(dart){dartUrlsForElements.push(dart);});return dartUrlsForElements;}catch(err){bactm.reportError(err);}},findClickDartDDO:function(){digitalData.page=digitalData.page||{};digitalData.page.pageInfo=digitalData.page.pageInfo||[];const pv=dataCollector.filter(function(d){return d.event==='pageview'});const pageInfoKey=pv[pv.length-1].pageInfoKey;if(digitalData.page.pageInfo.length>0&&digitalData.page.pageInfo[pageInfoKey]&&digitalData.page.pageInfo[pageInfoKey].hasOwnProperty('clickDART'))return bactm._asArray(digitalData.page.pageInfo[pageInfoKey].clickDART);digitalData.page.attributes=digitalData.page.attributes||{};const ddoClickDART=digitalData.page.attributes.clickDART?bactm._asArray(digitalData.page.attributes.clickDART):[];return ddoClickDART;},setupClickEvenListeners:function(clickDartParams){clickDartParams.forEach(item=>{const dartDetails=item.split('-_-');if(dartDetails.length<2)return;const selector=dartDetails[0]
const dartUrl=dartDetails[1];let element='';let elements='';if(!this.isAcceptableUrl(dartUrl))return;if(selector.indexOf('class>')>-1){selector=selector.split('>')[1];elements=document.getElementsByClassName(selector);if(!elements||elements.length===0)return;elements.forEach(element=>{this.addClickEventListener(element,dartUrl);})}
element=document.getElementById(selector);if(element){this.addClickEventListener(element,dartUrl);}
elements=document.getElementsByName(selector);elements.forEach(element=>{this.addClickEventListener(element,dartUrl);});});},addClickEventListener:function(el,dartUrl){if(el.addEventListener){el.addEventListener('click',function(){const dartParams=adapter.process.extractParamsFromDartURL(bactm._asArray(dartUrl));bactm.plugins.googleDartTag.fireDartTag(dartParams,'clickEvent');});}},isAcceptableUrl:function(str){if(!str)return false;return str.indexOf('http')>-1&&str.indexOf('://')>-1;},checkForVariable:function(variable){if((typeof variable==='string'&&this.isAcceptableUrl(variable))||(Array.isArray(variable)&&variable.length>0&&this.isAcceptableUrl(variable[0]))){return true;}else{return false;}}};const adapter=new Adapter();function GoogleDartTag(){bactm.on('setupDartTags',this.initializePageview.bind(this));bactm.on('initClickAttributes',adapter.process.setupClickDart);};GoogleDartTag.prototype.initializePageview=function(details){if(adapter.process.findStandardDartURL(details)){const dartUrl=adapter.process.findStandardDartURL(details);const dartParameters=adapter.process.extractParamsFromDartURL(dartUrl);this.fireDartTag(dartParameters,'pageview');}else{bactm._log("No standardDART url for pageload",LOG_LEVEL.INFO);}};GoogleDartTag.prototype.fireDartTag=function(dartParameters,type){let options={allow_custom_scripts:true,dc_custom_params:{}};if(type==='customEvent'){dartParameters=adapter.process.extractParamsFromCustomEvent(dartParameters);}
dartParameters.forEach(param=>{if(param.qty)options.qty=param.qty;if(param.cost)options.value=param.cost;if(param.ord)options.dc_custom_params.ord=param.ord;if(param.num)options.dc_custom_params.num=param.num;if(param.dc_lat)options.dc_custom_params.dc_lat=param.dc_lat;if(param.tag_for_child_directed_treatment){options.dc_custom_params.tag_for_child_directed_treatment=param.tag_for_child_directed_treatment;}
if(param.match_id)options.dc_custom_params.match_id=param.match_id;if(param.u3)options.u3=param.u3;if(param.u18)options.u18=param.u18;if(param.u24)options.u24=param.u24;if(param.u25)options.u25=param.u25;if(param.u26)options.u26=param.u26;if(param.u27)options.u27=param.u27;options.send_to="DC-"+param.src+"/"+param.type+"/"+param.cat+"+unique";try{bactm._log('-----------------FIRE DART TAG--------------------------',LOG_LEVEL.INFO);gtag('config','DC-'+param.src);gtag('event','conversion',options);if(type==='pageview'){bactm._log(DART_LOG.PAGEVIEW.SUCCESS,LOG_LEVEL.INFO);bactm._log('dartUrl: ',param.url,LOG_LEVEL.INFO);bactm._log('dartParameters: ',dartParameters,LOG_LEVEL.INFO);bactm._log('options: ',options,LOG_LEVEL.INFO);}else if(type==='customEvent'){bactm._log(DART_LOG.CUSTOM_EVENT.SUCCESS,LOG_LEVEL.INFO);bactm._log('custom event params: ',param,LOG_LEVEL.INFO);}else if(type==='clickEvent'){bactm._log(DART_LOG.CLICK_EVENT.SUCCESS,LOG_LEVEL.INFO);bactm._log('click event DART url: ',param.url,LOG_LEVEL.INFO);}else{bactm._log(DART_LOG.DEFAULT.SUCCESS,LOG_LEVEL.INFO);}}catch(e){if(type==='pageview'){bactm._log(DART_LOG.PAGEVIEW.ERROR,e,LOG_LEVEL.ERROR);}else if(type==='customEvent'){bactm._log(DART_LOG.CUSTOM_EVENT.ERROR,e,LOG_LEVEL.ERROR);}else if(type==='clickEvent'){bactm._log(DART_LOG.CLICK_EVENT.ERROR,LOG_LEVEL.ERROR);}else{bactm._log(DART_LOG.DEFAULT.SUCCESS,LOG_LEVEL.INFO);}}});}
const googleDartTag=new GoogleDartTag();return{fireDartTag:googleDartTag.fireDartTag.bind(googleDartTag)}});}
bactm.on('plugins:OneTrust:C0004:DynamicDartLoader',fireDartTag);}}catch(e){utag.DB(e)}}];u.send=function(a,b){if(u.ev[a]||u.ev.all!==undefined){var c,d,e,f,i;u.data={};for(c=0;c<u.extend.length;c++){try{d=u.extend[c](a,b);if(d==false)return}catch(e){}};for(d in utag.loader.GV(u.map)){if(b[d]!==undefined&&b[d]!==""){e=u.map[d].split(",");for(f=0;f<e.length;f++){u.data[e[f]]=b[d];}}}
}};utag.o[loader].loader.LOAD(id);})("21","bofa.main");}catch(error){utag.DB(error);}
